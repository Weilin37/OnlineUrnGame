{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\Weilin\\\\Documents\\\\GitHub\\\\UrbanTreeConservation\\\\client\\\\src\\\\js\\\\components\\\\GetMarkers.js\",\n    _s = $RefreshSig$();\n\nimport React, { useRef, useState } from \"react\";\nimport { makeStyles } from '@material-ui/core/styles';\nimport { useDispatch, useSelector, batch } from \"react-redux\";\nimport { Circle } from \"react-leaflet\";\nimport { Marker, Popup } from \"react-leaflet\";\nimport Button from '@material-ui/core/Button';\nimport Box from '@material-ui/core/Box';\nimport { renderToString } from 'react-dom/server';\nimport PixiOverlay from 'react-leaflet-pixi-overlay';\nimport Slider from '@material-ui/core/Slider';\nimport { setSimilarityCity1, setSimilarityCity2, setSimilarityState1, setSimilarityState2 } from \"../features/analysisSlice\";\nimport { useLeaflet } from \"react-leaflet\";\nimport Fab from '@material-ui/core/Fab';\nimport AdjustIcon from '@material-ui/icons/Adjust';\nimport { setEndpoint, getCity, clearCity, setScanStatus, setScanRadius, setScanCenter, setScanZoom, setViewStatus } from \"../features/markerSlice\";\nimport { setDrawMode, setSearch } from \"../features/mapSlice\";\nconst useStyles = makeStyles(theme => ({\n  scanMargin: {\n    margin: theme.spacing(1),\n    top: theme.spacing(34),\n    left: theme.spacing(1),\n    position: 'fixed',\n    zIndex: 1000\n  }\n}));\n\nconst GetMarkers = () => {\n  _s();\n\n  const stateMarker = useSelector(state => state.marker);\n  const stateAnalysis = useSelector(state => state.analysis);\n  const dispatch = useDispatch();\n  const classes = useStyles();\n  const {\n    map\n  } = useLeaflet();\n  const [endpoint, setEndpoint] = useState();\n  const [scan_lat, setScanLat] = useState();\n  const [scan_lng, setScanLng] = useState();\n  const [scan_radius, setScanRadius] = useState();\n  const [loading, setLoading] = useState(0);\n\n  function handleSimilarityClick(city, state) {\n    if (stateAnalysis.similarityCity1 === \"\") {\n      batch(() => {\n        dispatch(setSimilarityCity1(city));\n        dispatch(setSimilarityState1(state));\n      });\n    } else if (stateAnalysis.similarityCity2 === \"\") {\n      batch(() => {\n        dispatch(setSimilarityCity2(city));\n        dispatch(setSimilarityState2(state));\n      });\n    }\n  }\n\n  function toRadian(degree) {\n    return degree * Math.PI / 180;\n  }\n\n  function getDistance(origin, destination) {\n    // return distance in meters\n    var lon1 = toRadian(origin[1]),\n        lat1 = toRadian(origin[0]),\n        lon2 = toRadian(destination[1]),\n        lat2 = toRadian(destination[0]);\n    var deltaLat = lat2 - lat1;\n    var deltaLon = lon2 - lon1;\n    var a = Math.pow(Math.sin(deltaLat / 2), 2) + Math.cos(lat1) * Math.cos(lat2) * Math.pow(Math.sin(deltaLon / 2), 2);\n    var c = 2 * Math.asin(Math.sqrt(a));\n    var EARTH_RADIUS = 6371;\n    return c * EARTH_RADIUS * 1000;\n  }\n\n  function handleclick(e) {\n    if (stateMarker.view_status === \"city\" || stateMarker.view_status === \"global\") {\n      if (map.getZoom() < stateMarker.cityZoom) {\n        map.setZoom(stateMarker.cityZoom);\n      }\n\n      const zoom = map.getZoom();\n      const center = map.getCenter();\n      const lat = center.lat;\n      const lng = center.lng;\n      const bounds = map.getBounds();\n      const latNE = bounds['_northEast'].lat;\n      const lngNE = bounds['_northEast'].lng;\n      const radius = Math.round(0.5 * getDistance([latNE, lngNE], [lat, lng]));\n      setScanLat(lat);\n      setScanLng(lng);\n      setScanRadius(radius);\n      dispatch(getCity(\"/api/get/city?lat=\" + lat + \"&lng=\" + lng + \"&radius=\" + radius));\n    }\n  }\n\n  if (stateMarker.view_status === \"global\") {\n    console.log(\"Draw global\");\n    return stateMarker.global.map((el, i) => /*#__PURE__*/_jsxDEV(Marker, {\n      position: [el.latitude, el.longitude],\n      children: /*#__PURE__*/_jsxDEV(Popup, {\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: [el.city, \", \", el.state]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Number of Trees: \", el.total_species]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Number of Species: \", el.total_unique_species]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          pb: 4\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(Slider, {\n          defaultValue: el.count_native,\n          step: null,\n          min: 0,\n          max: el.total_species,\n          valueLabelDisplay: \"on\",\n          marks: [{\n            value: el.count_native,\n            label: 'Native'\n          }, {\n            value: el.total_species,\n            label: (el.total_species / 1000).toFixed() + \"K\"\n          }]\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: () => handleSimilarityClick(el.city, el.state),\n          value: el.city,\n          variant: \"outlined\",\n          size: \"small\",\n          color: \"primary\",\n          children: \"Compare\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 13\n      }, this)\n    }, i, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 11\n    }, this));\n  } else if (stateMarker.view_status === \"city\" && stateMarker.city.length == 0) {\n    console.log(\"Draw PixiOverlay\");\n    return /*#__PURE__*/_jsxDEV(Fab, {\n      onClick: handleclick,\n      size: \"small\",\n      color: \"primary\",\n      \"aria-label\": \"add\",\n      className: classes.scanMargin,\n      children: /*#__PURE__*/_jsxDEV(AdjustIcon, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 13\n    }, this);\n  } else if (stateMarker.view_status === \"city\" && stateMarker.city.length > 0) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(PixiOverlay, {\n        markers: stateMarker.city\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Circle, {\n        weight: 1,\n        opacity: 0.5,\n        fill: false,\n        center: [scan_lat, scan_lng],\n        radius: 1.5 * scan_radius\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Fab, {\n        onClick: handleclick,\n        size: \"small\",\n        color: \"primary\",\n        \"aria-label\": \"add\",\n        className: classes.scanMargin,\n        children: /*#__PURE__*/_jsxDEV(AdjustIcon, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 13\n    }, this);\n  } else {\n    return null;\n  }\n};\n\n_s(GetMarkers, \"iw81/Dz38RmRxnNGE6k7GacWYHI=\", false, function () {\n  return [useSelector, useSelector, useDispatch, useStyles, useLeaflet];\n});\n\n_c = GetMarkers;\nexport default GetMarkers;\n\nvar _c;\n\n$RefreshReg$(_c, \"GetMarkers\");","map":{"version":3,"sources":["C:/Users/Weilin/Documents/GitHub/UrbanTreeConservation/client/src/js/components/GetMarkers.js"],"names":["React","useRef","useState","makeStyles","useDispatch","useSelector","batch","Circle","Marker","Popup","Button","Box","renderToString","PixiOverlay","Slider","setSimilarityCity1","setSimilarityCity2","setSimilarityState1","setSimilarityState2","useLeaflet","Fab","AdjustIcon","setEndpoint","getCity","clearCity","setScanStatus","setScanRadius","setScanCenter","setScanZoom","setViewStatus","setDrawMode","setSearch","useStyles","theme","scanMargin","margin","spacing","top","left","position","zIndex","GetMarkers","stateMarker","state","marker","stateAnalysis","analysis","dispatch","classes","map","endpoint","scan_lat","setScanLat","scan_lng","setScanLng","scan_radius","loading","setLoading","handleSimilarityClick","city","similarityCity1","similarityCity2","toRadian","degree","Math","PI","getDistance","origin","destination","lon1","lat1","lon2","lat2","deltaLat","deltaLon","a","pow","sin","cos","c","asin","sqrt","EARTH_RADIUS","handleclick","e","view_status","getZoom","cityZoom","setZoom","zoom","center","getCenter","lat","lng","bounds","getBounds","latNE","lngNE","radius","round","console","log","global","el","i","latitude","longitude","total_species","total_unique_species","count_native","value","label","toFixed","length"],"mappings":"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","sourcesContent":["import React, {useRef, useState} from \"react\";\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport { useDispatch, useSelector, batch } from \"react-redux\";\r\nimport { Circle } from \"react-leaflet\";\r\nimport { Marker, Popup } from \"react-leaflet\";\r\nimport Button from '@material-ui/core/Button';\r\nimport Box from '@material-ui/core/Box';\r\nimport { renderToString } from 'react-dom/server';\r\nimport PixiOverlay from 'react-leaflet-pixi-overlay';\r\nimport Slider from '@material-ui/core/Slider';\r\nimport { setSimilarityCity1, setSimilarityCity2, setSimilarityState1, setSimilarityState2 } from \"../features/analysisSlice\";\r\n\r\nimport { useLeaflet } from \"react-leaflet\";\r\nimport Fab from '@material-ui/core/Fab';\r\nimport AdjustIcon from '@material-ui/icons/Adjust';\r\nimport { setEndpoint, getCity, clearCity, setScanStatus, setScanRadius, setScanCenter, setScanZoom, setViewStatus } from \"../features/markerSlice\";\r\nimport { setDrawMode, setSearch } from \"../features/mapSlice\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  scanMargin: {\r\n    margin: theme.spacing(1),\r\n    top: theme.spacing(34),\r\n    left: theme.spacing(1),\r\n    position: 'fixed',\r\n    zIndex: 1000,\r\n  }\r\n}));\r\n\r\nconst GetMarkers = () => {\r\n    const stateMarker = useSelector(state => state.marker);\r\n    const stateAnalysis = useSelector(state => state.analysis);\r\n    const dispatch = useDispatch();\r\n    const classes = useStyles();\r\n    const { map } = useLeaflet();\r\n\r\n    const [endpoint, setEndpoint] = useState();\r\n    const [scan_lat, setScanLat] = useState();\r\n    const [scan_lng, setScanLng] = useState();\r\n    const [scan_radius, setScanRadius] = useState();\r\n    const [loading, setLoading] = useState(0);\r\n\r\n    function handleSimilarityClick(city, state) {\r\n        if (stateAnalysis.similarityCity1 === \"\") {\r\n            batch(() => {\r\n                dispatch(setSimilarityCity1(city));\r\n                dispatch(setSimilarityState1(state));\r\n            });\r\n        } else if (stateAnalysis.similarityCity2 === \"\") {\r\n            batch(() => {\r\n                dispatch(setSimilarityCity2(city));\r\n                dispatch(setSimilarityState2(state));\r\n            });\r\n        }\r\n    }\r\n\r\n        function toRadian(degree) {\r\n        return degree*Math.PI/180;\r\n    }\r\n\r\n    function getDistance(origin, destination) {\r\n        // return distance in meters\r\n        var lon1 = toRadian(origin[1]),\r\n            lat1 = toRadian(origin[0]),\r\n            lon2 = toRadian(destination[1]),\r\n            lat2 = toRadian(destination[0]);\r\n\r\n        var deltaLat = lat2 - lat1;\r\n        var deltaLon = lon2 - lon1;\r\n\r\n        var a = Math.pow(Math.sin(deltaLat/2), 2) + Math.cos(lat1) * Math.cos(lat2) * Math.pow(Math.sin(deltaLon/2), 2);\r\n        var c = 2 * Math.asin(Math.sqrt(a));\r\n        var EARTH_RADIUS = 6371;\r\n        return c * EARTH_RADIUS * 1000;\r\n    }\r\n\r\n    function handleclick(e) {\r\n        if (stateMarker.view_status === \"city\" || stateMarker.view_status === \"global\") {\r\n            if (map.getZoom() < stateMarker.cityZoom) {\r\n                map.setZoom(stateMarker.cityZoom);\r\n            }\r\n            const zoom = map.getZoom();\r\n            const center = map.getCenter();\r\n            const lat = center.lat;\r\n            const lng = center.lng;\r\n            const bounds = map.getBounds();\r\n            const latNE = bounds['_northEast'].lat\r\n            const lngNE = bounds['_northEast'].lng\r\n            const radius = Math.round(0.5*getDistance([latNE, lngNE],[lat, lng]));\r\n            setScanLat(lat);\r\n            setScanLng(lng);\r\n            setScanRadius(radius);\r\n\r\n            dispatch(getCity(\"/api/get/city?lat=\"+lat+\"&lng=\"+lng+\"&radius=\"+radius));\r\n        }\r\n\r\n    }\r\n\r\n    if (stateMarker.view_status === \"global\"){\r\n        console.log(\"Draw global\");\r\n\r\n        return stateMarker.global.map((el, i) => (\r\n          <Marker\r\n            key={i}\r\n            position={[el.latitude, el.longitude]}\r\n          >\r\n            <Popup>\r\n                <p>{el.city}, {el.state}</p>\r\n                <p>Number of Trees: {el.total_species}</p>\r\n                <p>Number of Species: {el.total_unique_species}</p>\r\n                <Box pb={4} />\r\n                <Slider\r\n                    defaultValue={el.count_native}\r\n                    step={null}\r\n                    min={0}\r\n                    max={el.total_species}\r\n                    valueLabelDisplay=\"on\"\r\n                    marks={\r\n                        [\r\n                          {value: el.count_native,label: 'Native'},\r\n                          {value: el.total_species, label: (el.total_species/1000).toFixed()+\"K\"}\r\n                        ]\r\n                    }\r\n                />\r\n                <Button onClick={() => handleSimilarityClick(el.city, el.state)} value={el.city} variant=\"outlined\" size=\"small\" color=\"primary\">\r\n                  Compare\r\n                </Button>\r\n            </Popup>\r\n          </Marker>\r\n        ));\r\n    } else if (stateMarker.view_status === \"city\" && stateMarker.city.length == 0 )  {\r\n        console.log(\"Draw PixiOverlay\");\r\n        return (\r\n            <Fab onClick={handleclick} size=\"small\" color=\"primary\" aria-label=\"add\" className={classes.scanMargin}>\r\n                <AdjustIcon />\r\n            </Fab>\r\n        )\r\n    } else if (stateMarker.view_status === \"city\" && stateMarker.city.length > 0) {\r\n        return (\r\n            <div>\r\n                <PixiOverlay markers={stateMarker.city} />\r\n                <Circle\r\n                    weight={1}\r\n                    opacity={0.5}\r\n                    fill={false}\r\n                    center={[scan_lat, scan_lng]}\r\n                    radius={1.5*scan_radius} />\r\n                <Fab onClick={handleclick} size=\"small\" color=\"primary\" aria-label=\"add\" className={classes.scanMargin}>\r\n                    <AdjustIcon />\r\n                </Fab>\r\n            </div>\r\n        )\r\n    } else {\r\n        return null\r\n    }\r\n};\r\n\r\nexport default GetMarkers;"]},"metadata":{},"sourceType":"module"}